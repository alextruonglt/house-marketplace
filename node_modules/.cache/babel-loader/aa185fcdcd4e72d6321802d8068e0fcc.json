{"ast":null,"code":"import{useEffect,useState}from'react';import{collection,getDocs,query,where,orderBy,limit,startAfter}from'firebase/firestore';import{db}from'../firebase.config';import{toast}from'react-toastify';import Spinner from'../components/Spinner';import ListingItem from'../components/ListingItem';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";function Offers(){const[listings,setListings]=useState(null);const[loading,setLoading]=useState(true);const[lastFetchedListing,setLastFetchedListing]=useState(null);useEffect(()=>{const fetchListings=async()=>{try{// Get reference\nconst listingsRef=collection(db,'listings');// Create a query\nconst q=query(listingsRef,where('offer','==',true),orderBy('timestamp','desc'),limit(10));// Execute query\nconst querySnap=await getDocs(q);const lastVisible=querySnap.docs[querySnap.docs.length-1];setLastFetchedListing(lastVisible);const listings=[];querySnap.forEach(doc=>{return listings.push({id:doc.id,data:doc.data()});});setListings(listings);setLoading(false);}catch(error){toast.error('Could not fetch listings');}};fetchListings();},[]);// Pagination / Load More\nconst onFetchMoreListings=async()=>{try{// Get reference\nconst listingsRef=collection(db,'listings');// Create a query\nconst q=query(listingsRef,where('offer','==',true),orderBy('timestamp','desc'),startAfter(lastFetchedListing),limit(10));// Execute query\nconst querySnap=await getDocs(q);const lastVisible=querySnap.docs[querySnap.docs.length-1];setLastFetchedListing(lastVisible);const listings=[];querySnap.forEach(doc=>{return listings.push({id:doc.id,data:doc.data()});});setListings(prevState=>[...prevState,...listings]);setLoading(false);}catch(error){toast.error('Could not fetch listings');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"category\",children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"p\",{className:\"pageHeader\",children:\"Offers\"})}),loading?/*#__PURE__*/_jsx(Spinner,{}):listings&&listings.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsx(\"ul\",{className:\"categoryListings\",children:listings.map(listing=>/*#__PURE__*/_jsx(ListingItem,{listing:listing.data,id:listing.id},listing.id))})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),lastFetchedListing&&/*#__PURE__*/_jsx(\"p\",{className:\"loadMore\",onClick:onFetchMoreListings,children:\"Load More\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"There are no current offers\"})]});}export default Offers;","map":{"version":3,"names":["useEffect","useState","collection","getDocs","query","where","orderBy","limit","startAfter","db","toast","Spinner","ListingItem","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Offers","listings","setListings","loading","setLoading","lastFetchedListing","setLastFetchedListing","fetchListings","listingsRef","q","querySnap","lastVisible","docs","length","forEach","doc","push","id","data","error","onFetchMoreListings","prevState","className","children","map","listing","onClick"],"sources":["/Users/alextruong/Documents/Coding/house-marketplace/src/pages/Offers.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport {\n  collection,\n  getDocs,\n  query,\n  where,\n  orderBy,\n  limit,\n  startAfter,\n} from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { toast } from 'react-toastify'\nimport Spinner from '../components/Spinner'\nimport ListingItem from '../components/ListingItem'\n\nfunction Offers() {\n  const [listings, setListings] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [lastFetchedListing, setLastFetchedListing] = useState(null)\n\n  useEffect(() => {\n    const fetchListings = async () => {\n      try {\n        // Get reference\n        const listingsRef = collection(db, 'listings')\n\n        // Create a query\n        const q = query(\n          listingsRef,\n          where('offer', '==', true),\n          orderBy('timestamp', 'desc'),\n          limit(10)\n        )\n\n        // Execute query\n        const querySnap = await getDocs(q)\n\n        const lastVisible = querySnap.docs[querySnap.docs.length - 1]\n        setLastFetchedListing(lastVisible)\n\n        const listings = []\n\n        querySnap.forEach((doc) => {\n          return listings.push({\n            id: doc.id,\n            data: doc.data(),\n          })\n        })\n\n        setListings(listings)\n        setLoading(false)\n      } catch (error) {\n        toast.error('Could not fetch listings')\n      }\n    }\n\n    fetchListings()\n  }, [])\n\n  // Pagination / Load More\n  const onFetchMoreListings = async () => {\n    try {\n      // Get reference\n      const listingsRef = collection(db, 'listings')\n\n      // Create a query\n      const q = query(\n        listingsRef,\n        where('offer', '==', true),\n        orderBy('timestamp', 'desc'),\n        startAfter(lastFetchedListing),\n        limit(10)\n      )\n\n      // Execute query\n      const querySnap = await getDocs(q)\n\n      const lastVisible = querySnap.docs[querySnap.docs.length - 1]\n      setLastFetchedListing(lastVisible)\n\n      const listings = []\n\n      querySnap.forEach((doc) => {\n        return listings.push({\n          id: doc.id,\n          data: doc.data(),\n        })\n      })\n\n      setListings((prevState) => [...prevState, ...listings])\n      setLoading(false)\n    } catch (error) {\n      toast.error('Could not fetch listings')\n    }\n  }\n\n  return (\n    <div className='category'>\n      <header>\n        <p className='pageHeader'>Offers</p>\n      </header>\n\n      {loading ? (\n        <Spinner />\n      ) : listings && listings.length > 0 ? (\n        <>\n          <main>\n            <ul className='categoryListings'>\n              {listings.map((listing) => (\n                <ListingItem\n                  listing={listing.data}\n                  id={listing.id}\n                  key={listing.id}\n                />\n              ))}\n            </ul>\n          </main>\n\n          <br />\n          <br />\n          {lastFetchedListing && (\n            <p className='loadMore' onClick={onFetchMoreListings}>\n              Load More\n            </p>\n          )}\n        </>\n      ) : (\n        <p>There are no current offers</p>\n      )}\n    </div>\n  )\n}\n\nexport default Offers\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}