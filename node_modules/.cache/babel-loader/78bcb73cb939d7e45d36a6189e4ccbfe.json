{"ast":null,"code":"import{useState,useEffect}from'react';import{Link}from'react-router-dom';import{getAuth,updateProfile}from'firebase/auth';import{updateDoc,doc,collection,getDocs,query,where,orderBy,deleteDoc}from'firebase/firestore';import{db}from'../firebase.config';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import ListingItem from'../components/ListingItem';import arrowRight from\"../assets/svg/keyboardArrowRightIcon.svg\";import homeIcon from\"../assets/svg/homeIcon.svg\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Profile(){const auth=getAuth();const[loading,setLoading]=useState(true);const[listings,setListings]=useState(null);const[changeDetails,setChangeDetails]=useState(false);const[formData,setFormData]=useState({name:auth.currentUser.displayName,email:auth.currentUser.email});const{name,email}=formData;const navigate=useNavigate();useEffect(()=>{const fetchUserListings=async()=>{const listingsRef=collection(db,'listings');const q=query(listingsRef,where('userRef','==',auth.currentUser.uid),orderBy('timestamp','desc'));const querySnap=await getDocs(q);let listings=[];querySnap.forEach(doc=>{return listings.push({id:doc.id,data:doc.data()});});setListings(listings);setLoading(false);};fetchUserListings();},[auth.currentUser.uid]);const onLogout=()=>{auth.signOut();navigate('/');};const onSubmit=async()=>{try{if(auth.currentUser.displayName!==name){// Update display name in fb\nawait updateProfile(auth.currentUser,{displayName:name});// Update in firestore\nconst userRef=doc(db,'users',auth.currentUser.uid);await updateDoc(userRef,{name});}}catch(error){console.log(error);toast.error('Could not update profile details');}};const onChange=e=>{setFormData(prevState=>({...prevState,[e.target.id]:e.target.value}));};const onDelete=async listingId=>{if(window.confirm('Are you sure you want to delete?')){await deleteDoc(doc(db,'listings',listingId));const updatedListings=listings.filter(listing=>listing.id!==listingId);setListings(updatedListings);toast.success('Successfully deleted listing');}};const onEdit=listingId=>navigate(\"/edit-listing/\".concat(listingId));return/*#__PURE__*/_jsxs(\"div\",{className:\"profile\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"profileHeader\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"pageHeader\",children:\"My Profile\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"logOut\",onClick:onLogout,children:\"Logout\"})]}),/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profileDetailsHeader\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"profileDetailsText\",children:\"Personal Details\"}),/*#__PURE__*/_jsx(\"p\",{className:\"changePersonalDetails\",onClick:()=>{changeDetails&&onSubmit();setChangeDetails(prevState=>!prevState);},children:changeDetails?'done':'change'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"profileCard\",children:/*#__PURE__*/_jsxs(\"form\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"name\",className:!changeDetails?'profileName':'profileNameActive',disabled:!changeDetails,value:name,onChange:onChange}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",className:!changeDetails?'profileEmail':'profileEmailActive',disabled:!changeDetails,value:email,onChange:onChange})]})}),/*#__PURE__*/_jsxs(Link,{to:\"/create-listing\",className:\"createListing\",children:[/*#__PURE__*/_jsx(\"img\",{src:homeIcon,alt:\"home\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sell or rent your home\"}),/*#__PURE__*/_jsx(\"img\",{src:arrowRight,alt:\"arrow right\"})]}),!loading&&(listings===null||listings===void 0?void 0:listings.length)>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"listingText\",children:\"Your Listings\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"listingsList\",children:listings.map(listing=>/*#__PURE__*/_jsx(ListingItem,{listing:listing.data,id:listing.id,onDelete:()=>onDelete(listing.id),onEdit:()=>onEdit(listing.id)},listing.id))})]})]})]});}export default Profile;","map":{"version":3,"names":["useState","useEffect","Link","getAuth","updateProfile","updateDoc","doc","collection","getDocs","query","where","orderBy","deleteDoc","db","useNavigate","toast","ListingItem","arrowRight","homeIcon","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Profile","auth","loading","setLoading","listings","setListings","changeDetails","setChangeDetails","formData","setFormData","name","currentUser","displayName","email","navigate","fetchUserListings","listingsRef","q","uid","querySnap","forEach","push","id","data","onLogout","signOut","onSubmit","userRef","error","console","log","onChange","e","prevState","target","value","onDelete","listingId","window","confirm","updatedListings","filter","listing","success","onEdit","concat","className","children","type","onClick","disabled","to","src","alt","length","map"],"sources":["/Users/alextruong/Documents/Coding/house-marketplace/src/pages/Profile.js"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { Link } from 'react-router-dom'\nimport { getAuth, updateProfile } from 'firebase/auth'\nimport {\n  updateDoc,\n  doc,\n  collection,\n  getDocs,\n  query,\n  where,\n  orderBy,\n  deleteDoc,\n} from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport ListingItem from '../components/ListingItem'\nimport arrowRight from '../assets/svg/keyboardArrowRightIcon.svg'\nimport homeIcon from '../assets/svg/homeIcon.svg'\n\nfunction Profile() {\n  const auth = getAuth()\n  const [loading, setLoading] = useState(true)\n  const [listings, setListings] = useState(null)\n  const [changeDetails, setChangeDetails] = useState(false)\n  const [formData, setFormData] = useState({\n    name: auth.currentUser.displayName,\n    email: auth.currentUser.email,\n  })\n\n  const { name, email } = formData\n\n  const navigate = useNavigate()\n\n  useEffect(() => {\n    const fetchUserListings = async () => {\n      const listingsRef = collection(db, 'listings')\n\n      const q = query(\n        listingsRef,\n        where('userRef', '==', auth.currentUser.uid),\n        orderBy('timestamp', 'desc')\n      )\n\n      const querySnap = await getDocs(q)\n\n      let listings = []\n\n      querySnap.forEach((doc) => {\n        return listings.push({\n          id: doc.id,\n          data: doc.data(),\n        })\n      })\n\n      setListings(listings)\n      setLoading(false)\n    }\n\n    fetchUserListings()\n  }, [auth.currentUser.uid])\n\n  const onLogout = () => {\n    auth.signOut()\n    navigate('/')\n  }\n\n  const onSubmit = async () => {\n    try {\n      if (auth.currentUser.displayName !== name) {\n        // Update display name in fb\n        await updateProfile(auth.currentUser, {\n          displayName: name,\n        })\n\n        // Update in firestore\n        const userRef = doc(db, 'users', auth.currentUser.uid)\n        await updateDoc(userRef, {\n          name,\n        })\n      }\n    } catch (error) {\n      console.log(error)\n      toast.error('Could not update profile details')\n    }\n  }\n\n  const onChange = (e) => {\n    setFormData((prevState) => ({\n      ...prevState,\n      [e.target.id]: e.target.value,\n    }))\n  }\n\n  const onDelete = async (listingId) => {\n    if (window.confirm('Are you sure you want to delete?')) {\n      await deleteDoc(doc(db, 'listings', listingId))\n      const updatedListings = listings.filter(\n        (listing) => listing.id !== listingId\n      )\n      setListings(updatedListings)\n      toast.success('Successfully deleted listing')\n    }\n  }\n\n  const onEdit = (listingId) => navigate(`/edit-listing/${listingId}`)\n\n  return (\n    <div className='profile'>\n      <header className='profileHeader'>\n        <p className='pageHeader'>My Profile</p>\n        <button type='button' className='logOut' onClick={onLogout}>\n          Logout\n        </button>\n      </header>\n\n      <main>\n        <div className='profileDetailsHeader'>\n          <p className='profileDetailsText'>Personal Details</p>\n          <p\n            className='changePersonalDetails'\n            onClick={() => {\n              changeDetails && onSubmit()\n              setChangeDetails((prevState) => !prevState)\n            }}\n          >\n            {changeDetails ? 'done' : 'change'}\n          </p>\n        </div>\n\n        <div className='profileCard'>\n          <form>\n            <input\n              type='text'\n              id='name'\n              className={!changeDetails ? 'profileName' : 'profileNameActive'}\n              disabled={!changeDetails}\n              value={name}\n              onChange={onChange}\n            />\n            <input\n              type='email'\n              id='email'\n              className={!changeDetails ? 'profileEmail' : 'profileEmailActive'}\n              disabled={!changeDetails}\n              value={email}\n              onChange={onChange}\n            />\n          </form>\n        </div>\n\n        <Link to='/create-listing' className='createListing'>\n          <img src={homeIcon} alt='home' />\n          <p>Sell or rent your home</p>\n          <img src={arrowRight} alt='arrow right' />\n        </Link>\n\n        {!loading && listings?.length > 0 && (\n          <>\n            <p className='listingText'>Your Listings</p>\n            <ul className='listingsList'>\n              {listings.map((listing) => (\n                <ListingItem\n                  key={listing.id}\n                  listing={listing.data}\n                  id={listing.id}\n                  onDelete={() => onDelete(listing.id)}\n                  onEdit={() => onEdit(listing.id)}\n                />\n              ))}\n            </ul>\n          </>\n        )}\n      </main>\n    </div>\n  )\n}\n\nexport default Profile\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}