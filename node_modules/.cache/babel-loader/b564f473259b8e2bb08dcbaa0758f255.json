{"ast":null,"code":"import{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{collection,getDocs,query,where,orderBy,limit,startAfter}from'firebase/firestore';import{db}from'../firebase.config';import{toast}from'react-toastify';import Spinner from'../components/Spinner';import ListingItem from'../components/ListingItem';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";function Category(){const[listings,setListings]=useState(null);const[loading,setLoading]=useState(true);const[lastFetchedListing,setLastFetchedListing]=useState(null);const params=useParams();useEffect(()=>{const fetchListings=async()=>{try{// Get reference\nconst listingsRef=collection(db,'listings');// Create a query\nconst q=query(listingsRef,where('type','==',params.categoryName),orderBy('timestamp','desc'),limit(10));// Execute query\nconst querySnap=await getDocs(q);const lastVisible=querySnap.docs[querySnap.docs.length-1];setLastFetchedListing(lastVisible);const listings=[];querySnap.forEach(doc=>{return listings.push({id:doc.id,data:doc.data()});});setListings(listings);setLoading(false);}catch(error){toast.error('Could not fetch listings');}};fetchListings();},[params.categoryName]);// Pagination / Load More\nconst onFetchMoreListings=async()=>{try{// Get reference\nconst listingsRef=collection(db,'listings');// Create a query\nconst q=query(listingsRef,where('type','==',params.categoryName),orderBy('timestamp','desc'),startAfter(lastFetchedListing),limit(10));// Execute query\nconst querySnap=await getDocs(q);const lastVisible=querySnap.docs[querySnap.docs.length-1];setLastFetchedListing(lastVisible);const listings=[];querySnap.forEach(doc=>{return listings.push({id:doc.id,data:doc.data()});});setListings(prevState=>[...prevState,...listings]);setLoading(false);}catch(error){toast.error('Could not fetch listings');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"category\",children:[/*#__PURE__*/_jsx(\"header\",{children:/*#__PURE__*/_jsx(\"p\",{className:\"pageHeader\",children:params.categoryName==='rent'?'Places for rent':'Places for sale'})}),loading?/*#__PURE__*/_jsx(Spinner,{}):listings&&listings.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsx(\"ul\",{className:\"categoryListings\",children:listings.map(listing=>/*#__PURE__*/_jsx(ListingItem,{listing:listing.data,id:listing.id},listing.id))})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),lastFetchedListing&&/*#__PURE__*/_jsx(\"p\",{className:\"loadMore\",onClick:onFetchMoreListings,children:\"Load More\"})]}):/*#__PURE__*/_jsxs(\"p\",{children:[\"No listings for \",params.categoryName]})]});}export default Category;","map":{"version":3,"names":["useEffect","useState","useParams","collection","getDocs","query","where","orderBy","limit","startAfter","db","toast","Spinner","ListingItem","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","Category","listings","setListings","loading","setLoading","lastFetchedListing","setLastFetchedListing","params","fetchListings","listingsRef","q","categoryName","querySnap","lastVisible","docs","length","forEach","doc","push","id","data","error","onFetchMoreListings","prevState","className","children","map","listing","onClick"],"sources":["/Users/alextruong/Documents/Coding/house-marketplace/src/pages/Category.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { useParams } from 'react-router-dom'\nimport {\n  collection,\n  getDocs,\n  query,\n  where,\n  orderBy,\n  limit,\n  startAfter,\n} from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { toast } from 'react-toastify'\nimport Spinner from '../components/Spinner'\nimport ListingItem from '../components/ListingItem'\n\nfunction Category() {\n  const [listings, setListings] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [lastFetchedListing, setLastFetchedListing] = useState(null)\n\n  const params = useParams()\n\n  useEffect(() => {\n    const fetchListings = async () => {\n      try {\n        // Get reference\n        const listingsRef = collection(db, 'listings')\n\n        // Create a query\n        const q = query(\n          listingsRef,\n          where('type', '==', params.categoryName),\n          orderBy('timestamp', 'desc'),\n          limit(10)\n        )\n\n        // Execute query\n        const querySnap = await getDocs(q)\n\n        const lastVisible = querySnap.docs[querySnap.docs.length - 1]\n        setLastFetchedListing(lastVisible)\n\n        const listings = []\n\n        querySnap.forEach((doc) => {\n          return listings.push({\n            id: doc.id,\n            data: doc.data(),\n          })\n        })\n\n        setListings(listings)\n        setLoading(false)\n      } catch (error) {\n        toast.error('Could not fetch listings')\n      }\n    }\n\n    fetchListings()\n  }, [params.categoryName])\n\n  // Pagination / Load More\n  const onFetchMoreListings = async () => {\n    try {\n      // Get reference\n      const listingsRef = collection(db, 'listings')\n\n      // Create a query\n      const q = query(\n        listingsRef,\n        where('type', '==', params.categoryName),\n        orderBy('timestamp', 'desc'),\n        startAfter(lastFetchedListing),\n        limit(10)\n      )\n\n      // Execute query\n      const querySnap = await getDocs(q)\n\n      const lastVisible = querySnap.docs[querySnap.docs.length - 1]\n      setLastFetchedListing(lastVisible)\n\n      const listings = []\n\n      querySnap.forEach((doc) => {\n        return listings.push({\n          id: doc.id,\n          data: doc.data(),\n        })\n      })\n\n      setListings((prevState) => [...prevState, ...listings])\n      setLoading(false)\n    } catch (error) {\n      toast.error('Could not fetch listings')\n    }\n  }\n\n  return (\n    <div className='category'>\n      <header>\n        <p className='pageHeader'>\n          {params.categoryName === 'rent'\n            ? 'Places for rent'\n            : 'Places for sale'}\n        </p>\n      </header>\n\n      {loading ? (\n        <Spinner />\n      ) : listings && listings.length > 0 ? (\n        <>\n          <main>\n            <ul className='categoryListings'>\n              {listings.map((listing) => (\n                <ListingItem\n                  listing={listing.data}\n                  id={listing.id}\n                  key={listing.id}\n                />\n              ))}\n            </ul>\n          </main>\n\n          <br />\n          <br />\n          {lastFetchedListing && (\n            <p className='loadMore' onClick={onFetchMoreListings}>\n              Load More\n            </p>\n          )}\n        </>\n      ) : (\n        <p>No listings for {params.categoryName}</p>\n      )}\n    </div>\n  )\n}\n\nexport default Category\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,SAAS,KAAQ,kBAAkB,CAC5C,OACEC,UAAU,CACVC,OAAO,CACPC,KAAK,CACLC,KAAK,CACLC,OAAO,CACPC,KAAK,CACLC,UAAU,KACL,oBAAoB,CAC3B,OAASC,EAAE,KAAQ,oBAAoB,CACvC,OAASC,KAAK,KAAQ,gBAAgB,CACtC,MAAO,CAAAC,OAAO,KAAM,uBAAuB,CAC3C,MAAO,CAAAC,WAAW,KAAM,2BAA2B,QAAAC,GAAA,IAAAC,IAAA,CAAAC,QAAA,IAAAC,SAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEnD,QAAS,CAAAC,QAAQA,CAAA,CAAG,CAClB,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGrB,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAACsB,OAAO,CAAEC,UAAU,CAAC,CAAGvB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACwB,kBAAkB,CAAEC,qBAAqB,CAAC,CAAGzB,QAAQ,CAAC,IAAI,CAAC,CAElE,KAAM,CAAA0B,MAAM,CAAGzB,SAAS,CAAC,CAAC,CAE1BF,SAAS,CAAC,IAAM,CACd,KAAM,CAAA4B,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACF;AACA,KAAM,CAAAC,WAAW,CAAG1B,UAAU,CAACO,EAAE,CAAE,UAAU,CAAC,CAE9C;AACA,KAAM,CAAAoB,CAAC,CAAGzB,KAAK,CACbwB,WAAW,CACXvB,KAAK,CAAC,MAAM,CAAE,IAAI,CAAEqB,MAAM,CAACI,YAAY,CAAC,CACxCxB,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAC5BC,KAAK,CAAC,EAAE,CACV,CAAC,CAED;AACA,KAAM,CAAAwB,SAAS,CAAG,KAAM,CAAA5B,OAAO,CAAC0B,CAAC,CAAC,CAElC,KAAM,CAAAG,WAAW,CAAGD,SAAS,CAACE,IAAI,CAACF,SAAS,CAACE,IAAI,CAACC,MAAM,CAAG,CAAC,CAAC,CAC7DT,qBAAqB,CAACO,WAAW,CAAC,CAElC,KAAM,CAAAZ,QAAQ,CAAG,EAAE,CAEnBW,SAAS,CAACI,OAAO,CAAEC,GAAG,EAAK,CACzB,MAAO,CAAAhB,QAAQ,CAACiB,IAAI,CAAC,CACnBC,EAAE,CAAEF,GAAG,CAACE,EAAE,CACVC,IAAI,CAAEH,GAAG,CAACG,IAAI,CAAC,CACjB,CAAC,CAAC,CACJ,CAAC,CAAC,CAEFlB,WAAW,CAACD,QAAQ,CAAC,CACrBG,UAAU,CAAC,KAAK,CAAC,CACnB,CAAE,MAAOiB,KAAK,CAAE,CACd9B,KAAK,CAAC8B,KAAK,CAAC,0BAA0B,CAAC,CACzC,CACF,CAAC,CAEDb,aAAa,CAAC,CAAC,CACjB,CAAC,CAAE,CAACD,MAAM,CAACI,YAAY,CAAC,CAAC,CAEzB;AACA,KAAM,CAAAW,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACtC,GAAI,CACF;AACA,KAAM,CAAAb,WAAW,CAAG1B,UAAU,CAACO,EAAE,CAAE,UAAU,CAAC,CAE9C;AACA,KAAM,CAAAoB,CAAC,CAAGzB,KAAK,CACbwB,WAAW,CACXvB,KAAK,CAAC,MAAM,CAAE,IAAI,CAAEqB,MAAM,CAACI,YAAY,CAAC,CACxCxB,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAC5BE,UAAU,CAACgB,kBAAkB,CAAC,CAC9BjB,KAAK,CAAC,EAAE,CACV,CAAC,CAED;AACA,KAAM,CAAAwB,SAAS,CAAG,KAAM,CAAA5B,OAAO,CAAC0B,CAAC,CAAC,CAElC,KAAM,CAAAG,WAAW,CAAGD,SAAS,CAACE,IAAI,CAACF,SAAS,CAACE,IAAI,CAACC,MAAM,CAAG,CAAC,CAAC,CAC7DT,qBAAqB,CAACO,WAAW,CAAC,CAElC,KAAM,CAAAZ,QAAQ,CAAG,EAAE,CAEnBW,SAAS,CAACI,OAAO,CAAEC,GAAG,EAAK,CACzB,MAAO,CAAAhB,QAAQ,CAACiB,IAAI,CAAC,CACnBC,EAAE,CAAEF,GAAG,CAACE,EAAE,CACVC,IAAI,CAAEH,GAAG,CAACG,IAAI,CAAC,CACjB,CAAC,CAAC,CACJ,CAAC,CAAC,CAEFlB,WAAW,CAAEqB,SAAS,EAAK,CAAC,GAAGA,SAAS,CAAE,GAAGtB,QAAQ,CAAC,CAAC,CACvDG,UAAU,CAAC,KAAK,CAAC,CACnB,CAAE,MAAOiB,KAAK,CAAE,CACd9B,KAAK,CAAC8B,KAAK,CAAC,0BAA0B,CAAC,CACzC,CACF,CAAC,CAED,mBACEtB,KAAA,QAAKyB,SAAS,CAAC,UAAU,CAAAC,QAAA,eACvB9B,IAAA,WAAA8B,QAAA,cACE9B,IAAA,MAAG6B,SAAS,CAAC,YAAY,CAAAC,QAAA,CACtBlB,MAAM,CAACI,YAAY,GAAK,MAAM,CAC3B,iBAAiB,CACjB,iBAAiB,CACpB,CAAC,CACE,CAAC,CAERR,OAAO,cACNR,IAAA,CAACH,OAAO,GAAE,CAAC,CACTS,QAAQ,EAAIA,QAAQ,CAACc,MAAM,CAAG,CAAC,cACjChB,KAAA,CAAAF,SAAA,EAAA4B,QAAA,eACE9B,IAAA,SAAA8B,QAAA,cACE9B,IAAA,OAAI6B,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAC7BxB,QAAQ,CAACyB,GAAG,CAAEC,OAAO,eACpBhC,IAAA,CAACF,WAAW,EACVkC,OAAO,CAAEA,OAAO,CAACP,IAAK,CACtBD,EAAE,CAAEQ,OAAO,CAACR,EAAG,EACVQ,OAAO,CAACR,EACd,CACF,CAAC,CACA,CAAC,CACD,CAAC,cAEPxB,IAAA,QAAK,CAAC,cACNA,IAAA,QAAK,CAAC,CACLU,kBAAkB,eACjBV,IAAA,MAAG6B,SAAS,CAAC,UAAU,CAACI,OAAO,CAAEN,mBAAoB,CAAAG,QAAA,CAAC,WAEtD,CAAG,CACJ,EACD,CAAC,cAEH1B,KAAA,MAAA0B,QAAA,EAAG,kBAAgB,CAAClB,MAAM,CAACI,YAAY,EAAI,CAC5C,EACE,CAAC,CAEV,CAEA,cAAe,CAAAX,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module"}