{"ast":null,"code":"var _jsxFileName = \"/Users/alextruong/Documents/Coding/house-marketplace/src/pages/EditListing.js\",\n  _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\nimport { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\nimport { doc, updateDoc, getDoc, serverTimestamp } from 'firebase/firestore';\nimport { db } from '../firebase.config';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport { v4 as uuidv4 } from 'uuid';\nimport Spinner from '../components/Spinner';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction EditListing() {\n  _s();\n  // eslint-disable-next-line\n  const [geolocationEnabled, setGeolocationEnabled] = useState(true);\n  const [loading, setLoading] = useState(false);\n  const [listing, setListing] = useState(false);\n  const [formData, setFormData] = useState({\n    type: 'rent',\n    name: '',\n    bedrooms: 1,\n    bathrooms: 1,\n    parking: false,\n    furnished: false,\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0\n  });\n  const {\n    type,\n    name,\n    bedrooms,\n    bathrooms,\n    parking,\n    furnished,\n    address,\n    offer,\n    regularPrice,\n    discountedPrice,\n    images,\n    latitude,\n    longitude\n  } = formData;\n  const auth = getAuth();\n  const navigate = useNavigate();\n  const params = useParams();\n  const isMounted = useRef(true);\n\n  // Redirect if listing is not user's\n  useEffect(() => {\n    if (listing && listing.userRef !== auth.currentUser.uid) {\n      toast.error('You can not edit that listing');\n      navigate('/');\n    }\n  });\n\n  // Fetch listing to edit\n  useEffect(() => {\n    setLoading(true);\n    const fetchListing = async () => {\n      const docRef = doc(db, 'listings', params.listingId);\n      const docSnap = await getDoc(docRef);\n      if (docSnap.exists()) {\n        setListing(docSnap.data());\n        setFormData({\n          ...docSnap.data(),\n          address: docSnap.data().location\n        });\n        setLoading(false);\n      } else {\n        navigate('/');\n        toast.error('Listing does not exist');\n      }\n    };\n    fetchListing();\n  }, [params.listingId, navigate]);\n\n  // Sets userRef to logged in user\n  useEffect(() => {\n    if (isMounted) {\n      onAuthStateChanged(auth, user => {\n        if (user) {\n          setFormData({\n            ...formData,\n            userRef: user.uid\n          });\n        } else {\n          navigate('/sign-in');\n        }\n      });\n    }\n    return () => {\n      isMounted.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted]);\n  const onSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n    if (discountedPrice >= regularPrice) {\n      setLoading(false);\n      toast.error('Discounted price needs to be less than regular price');\n      return;\n    }\n    if (images.length > 6) {\n      setLoading(false);\n      toast.error('Max 6 images');\n      return;\n    }\n    let geolocation = {};\n    let location;\n    if (geolocationEnabled) {\n      var _data$results$0$geome, _data$results$, _data$results$0$geome2, _data$results$2, _data$results$3;\n      const response = await fetch(\"https://maps.googleapis.com/maps/api/geocode/json?address=\".concat(address, \"&key=\").concat(process.env.REACT_APP_GEOCODE_API_KEY));\n      const data = await response.json();\n      geolocation.lat = (_data$results$0$geome = (_data$results$ = data.results[0]) === null || _data$results$ === void 0 ? void 0 : _data$results$.geometry.location.lat) !== null && _data$results$0$geome !== void 0 ? _data$results$0$geome : 0;\n      geolocation.lng = (_data$results$0$geome2 = (_data$results$2 = data.results[0]) === null || _data$results$2 === void 0 ? void 0 : _data$results$2.geometry.location.lng) !== null && _data$results$0$geome2 !== void 0 ? _data$results$0$geome2 : 0;\n      location = data.status === 'ZERO_RESULTS' ? undefined : (_data$results$3 = data.results[0]) === null || _data$results$3 === void 0 ? void 0 : _data$results$3.formatted_address;\n      if (location === undefined || location.includes('undefined')) {\n        setLoading(false);\n        toast.error('Please enter a correct address');\n        return;\n      }\n    } else {\n      geolocation.lat = latitude;\n      geolocation.lng = longitude;\n    }\n\n    // Store image in firebase\n    const storeImage = async image => {\n      return new Promise((resolve, reject) => {\n        const storage = getStorage();\n        const fileName = \"\".concat(auth.currentUser.uid, \"-\").concat(image.name, \"-\").concat(uuidv4());\n        const storageRef = ref(storage, 'images/' + fileName);\n        const uploadTask = uploadBytesResumable(storageRef, image);\n        uploadTask.on('state_changed', snapshot => {\n          const progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n          console.log('Upload is ' + progress + '% done');\n          switch (snapshot.state) {\n            case 'paused':\n              console.log('Upload is paused');\n              break;\n            case 'running':\n              console.log('Upload is running');\n              break;\n            default:\n              break;\n          }\n        }, error => {\n          reject(error);\n        }, () => {\n          // Handle successful uploads on complete\n          // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n          getDownloadURL(uploadTask.snapshot.ref).then(downloadURL => {\n            resolve(downloadURL);\n          });\n        });\n      });\n    };\n    const imgUrls = await Promise.all([...images].map(image => storeImage(image))).catch(() => {\n      setLoading(false);\n      toast.error('Images not uploaded');\n      return;\n    });\n    const formDataCopy = {\n      ...formData,\n      imgUrls,\n      geolocation,\n      timestamp: serverTimestamp()\n    };\n    formDataCopy.location = address;\n    delete formDataCopy.images;\n    delete formDataCopy.address;\n    !formDataCopy.offer && delete formDataCopy.discountedPrice;\n\n    // Update listing\n    const docRef = doc(db, 'listings', params.listingId);\n    await updateDoc(docRef, formDataCopy);\n    setLoading(false);\n    toast.success('Listing saved');\n    navigate(\"/category/\".concat(formDataCopy.type, \"/\").concat(docRef.id));\n  };\n  const onMutate = e => {\n    let boolean = null;\n    if (e.target.value === 'true') {\n      boolean = true;\n    }\n    if (e.target.value === 'false') {\n      boolean = false;\n    }\n\n    // Files\n    if (e.target.files) {\n      setFormData(prevState => ({\n        ...prevState,\n        images: e.target.files\n      }));\n    }\n\n    // Text/Booleans/Numbers\n    if (!e.target.files) {\n      setFormData(prevState => {\n        var _boolean;\n        return {\n          ...prevState,\n          [e.target.id]: (_boolean = boolean) !== null && _boolean !== void 0 ? _boolean : e.target.value\n        };\n      });\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"profile\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"pageHeader\",\n        children: \"Edit Listing\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: onSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Sell / Rent\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'sale' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"sale\",\n            onClick: onMutate,\n            children: \"Sell\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: type === 'rent' ? 'formButtonActive' : 'formButton',\n            id: \"type\",\n            value: \"rent\",\n            onClick: onMutate,\n            children: \"Rent\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputName\",\n          type: \"text\",\n          id: \"name\",\n          value: name,\n          onChange: onMutate,\n          maxLength: \"32\",\n          minLength: \"10\",\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formRooms flex\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Bedrooms\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 292,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"bedrooms\",\n              value: bedrooms,\n              onChange: onMutate,\n              min: \"1\",\n              max: \"50\",\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Bathrooms\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"bathrooms\",\n              value: bathrooms,\n              onChange: onMutate,\n              min: \"1\",\n              max: \"50\",\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 306,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Parking spot\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: parking ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"parking\",\n            value: true,\n            onClick: onMutate,\n            min: \"1\",\n            max: \"50\",\n            children: \"Yes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: !parking && parking !== null ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"parking\",\n            value: false,\n            onClick: onMutate,\n            children: \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Furnished\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: furnished ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"furnished\",\n            value: true,\n            onClick: onMutate,\n            children: \"Yes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: !furnished && furnished !== null ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"furnished\",\n            value: false,\n            onClick: onMutate,\n            children: \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Address\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n          className: \"formInputAddress\",\n          type: \"text\",\n          id: \"address\",\n          value: address,\n          onChange: onMutate,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 11\n        }, this), !geolocationEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formLatLng flex\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Latitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"latitude\",\n              value: latitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"formLabel\",\n              children: \"Longitude\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"formInputSmall\",\n              type: \"number\",\n              id: \"longitude\",\n              value: longitude,\n              onChange: onMutate,\n              required: true\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 396,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Offer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formButtons\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: offer ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: true,\n            onClick: onMutate,\n            children: \"Yes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 410,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: !offer && offer !== null ? 'formButtonActive' : 'formButton',\n            type: \"button\",\n            id: \"offer\",\n            value: false,\n            onClick: onMutate,\n            children: \"No\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Regular Price\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formPriceDiv\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"regularPrice\",\n            value: regularPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 13\n          }, this), type === 'rent' && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"formPriceText\",\n            children: \"$ / Month\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), offer && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"formLabel\",\n            children: \"Discounted Price\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 449,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"formInputSmall\",\n            type: \"number\",\n            id: \"discountedPrice\",\n            value: discountedPrice,\n            onChange: onMutate,\n            min: \"50\",\n            max: \"750000000\",\n            required: offer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 450,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"formLabel\",\n          children: \"Images\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"imagesInfo\",\n          children: \"The first image will be the cover (max 6).\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 464,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"formInputFile\",\n          type: \"file\",\n          id: \"images\",\n          onChange: onMutate,\n          max: \"6\",\n          accept: \".jpg,.png,.jpeg\",\n          multiple: true,\n          required: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"primaryButton createListingButton\",\n          children: \"Edit Listing\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 249,\n    columnNumber: 5\n  }, this);\n}\n_s(EditListing, \"dCuVH2WxcKZvEKTWsAjFCUOKDcI=\", false, function () {\n  return [useNavigate, useParams];\n});\n_c = EditListing;\nexport default EditListing;\nvar _c;\n$RefreshReg$(_c, \"EditListing\");","map":{"version":3,"names":["useState","useEffect","useRef","getAuth","onAuthStateChanged","getStorage","ref","uploadBytesResumable","getDownloadURL","doc","updateDoc","getDoc","serverTimestamp","db","useNavigate","useParams","toast","v4","uuidv4","Spinner","jsxDEV","_jsxDEV","Fragment","_Fragment","EditListing","_s","geolocationEnabled","setGeolocationEnabled","loading","setLoading","listing","setListing","formData","setFormData","type","name","bedrooms","bathrooms","parking","furnished","address","offer","regularPrice","discountedPrice","images","latitude","longitude","auth","navigate","params","isMounted","userRef","currentUser","uid","error","fetchListing","docRef","listingId","docSnap","exists","data","location","user","current","onSubmit","e","preventDefault","length","geolocation","_data$results$0$geome","_data$results$","_data$results$0$geome2","_data$results$2","_data$results$3","response","fetch","concat","process","env","REACT_APP_GEOCODE_API_KEY","json","lat","results","geometry","lng","status","undefined","formatted_address","includes","storeImage","image","Promise","resolve","reject","storage","fileName","storageRef","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","console","log","state","then","downloadURL","imgUrls","all","map","catch","formDataCopy","timestamp","success","id","onMutate","boolean","target","value","files","prevState","_boolean","_jsxFileName","lineNumber","columnNumber","className","children","onClick","onChange","maxLength","minLength","required","min","max","accept","multiple","_c","$RefreshReg$"],"sources":["/Users/alextruong/Documents/Coding/house-marketplace/src/pages/EditListing.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react'\nimport { getAuth, onAuthStateChanged } from 'firebase/auth'\nimport {\n  getStorage,\n  ref,\n  uploadBytesResumable,\n  getDownloadURL,\n} from 'firebase/storage'\nimport { doc, updateDoc, getDoc, serverTimestamp } from 'firebase/firestore'\nimport { db } from '../firebase.config'\nimport { useNavigate, useParams } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport { v4 as uuidv4 } from 'uuid'\nimport Spinner from '../components/Spinner'\n\nfunction EditListing() {\n  // eslint-disable-next-line\n  const [geolocationEnabled, setGeolocationEnabled] = useState(true)\n  const [loading, setLoading] = useState(false)\n  const [listing, setListing] = useState(false)\n  const [formData, setFormData] = useState({\n    type: 'rent',\n    name: '',\n    bedrooms: 1,\n    bathrooms: 1,\n    parking: false,\n    furnished: false,\n    address: '',\n    offer: false,\n    regularPrice: 0,\n    discountedPrice: 0,\n    images: {},\n    latitude: 0,\n    longitude: 0,\n  })\n\n  const {\n    type,\n    name,\n    bedrooms,\n    bathrooms,\n    parking,\n    furnished,\n    address,\n    offer,\n    regularPrice,\n    discountedPrice,\n    images,\n    latitude,\n    longitude,\n  } = formData\n\n  const auth = getAuth()\n  const navigate = useNavigate()\n  const params = useParams()\n  const isMounted = useRef(true)\n\n  // Redirect if listing is not user's\n  useEffect(() => {\n    if (listing && listing.userRef !== auth.currentUser.uid) {\n      toast.error('You can not edit that listing')\n      navigate('/')\n    }\n  })\n\n  // Fetch listing to edit\n  useEffect(() => {\n    setLoading(true)\n    const fetchListing = async () => {\n      const docRef = doc(db, 'listings', params.listingId)\n      const docSnap = await getDoc(docRef)\n      if (docSnap.exists()) {\n        setListing(docSnap.data())\n        setFormData({ ...docSnap.data(), address: docSnap.data().location })\n        setLoading(false)\n      } else {\n        navigate('/')\n        toast.error('Listing does not exist')\n      }\n    }\n\n    fetchListing()\n  }, [params.listingId, navigate])\n\n  // Sets userRef to logged in user\n  useEffect(() => {\n    if (isMounted) {\n      onAuthStateChanged(auth, (user) => {\n        if (user) {\n          setFormData({ ...formData, userRef: user.uid })\n        } else {\n          navigate('/sign-in')\n        }\n      })\n    }\n\n    return () => {\n      isMounted.current = false\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isMounted])\n\n  const onSubmit = async (e) => {\n    e.preventDefault()\n\n    setLoading(true)\n\n    if (discountedPrice >= regularPrice) {\n      setLoading(false)\n      toast.error('Discounted price needs to be less than regular price')\n      return\n    }\n\n    if (images.length > 6) {\n      setLoading(false)\n      toast.error('Max 6 images')\n      return\n    }\n\n    let geolocation = {}\n    let location\n\n    if (geolocationEnabled) {\n      const response = await fetch(\n        `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=${process.env.REACT_APP_GEOCODE_API_KEY}`\n      )\n\n      const data = await response.json()\n\n      geolocation.lat = data.results[0]?.geometry.location.lat ?? 0\n      geolocation.lng = data.results[0]?.geometry.location.lng ?? 0\n\n      location =\n        data.status === 'ZERO_RESULTS'\n          ? undefined\n          : data.results[0]?.formatted_address\n\n      if (location === undefined || location.includes('undefined')) {\n        setLoading(false)\n        toast.error('Please enter a correct address')\n        return\n      }\n    } else {\n      geolocation.lat = latitude\n      geolocation.lng = longitude\n    }\n\n    // Store image in firebase\n    const storeImage = async (image) => {\n      return new Promise((resolve, reject) => {\n        const storage = getStorage()\n        const fileName = `${auth.currentUser.uid}-${image.name}-${uuidv4()}`\n\n        const storageRef = ref(storage, 'images/' + fileName)\n\n        const uploadTask = uploadBytesResumable(storageRef, image)\n\n        uploadTask.on(\n          'state_changed',\n          (snapshot) => {\n            const progress =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n            console.log('Upload is ' + progress + '% done')\n            switch (snapshot.state) {\n              case 'paused':\n                console.log('Upload is paused')\n                break\n              case 'running':\n                console.log('Upload is running')\n                break\n              default:\n                break\n            }\n          },\n          (error) => {\n            reject(error)\n          },\n          () => {\n            // Handle successful uploads on complete\n            // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n            getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n              resolve(downloadURL)\n            })\n          }\n        )\n      })\n    }\n\n    const imgUrls = await Promise.all(\n      [...images].map((image) => storeImage(image))\n    ).catch(() => {\n      setLoading(false)\n      toast.error('Images not uploaded')\n      return\n    })\n\n    const formDataCopy = {\n      ...formData,\n      imgUrls,\n      geolocation,\n      timestamp: serverTimestamp(),\n    }\n\n    formDataCopy.location = address\n    delete formDataCopy.images\n    delete formDataCopy.address\n    !formDataCopy.offer && delete formDataCopy.discountedPrice\n\n    // Update listing\n    const docRef = doc(db, 'listings', params.listingId)\n    await updateDoc(docRef, formDataCopy)\n    setLoading(false)\n    toast.success('Listing saved')\n    navigate(`/category/${formDataCopy.type}/${docRef.id}`)\n  }\n\n  const onMutate = (e) => {\n    let boolean = null\n\n    if (e.target.value === 'true') {\n      boolean = true\n    }\n    if (e.target.value === 'false') {\n      boolean = false\n    }\n\n    // Files\n    if (e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        images: e.target.files,\n      }))\n    }\n\n    // Text/Booleans/Numbers\n    if (!e.target.files) {\n      setFormData((prevState) => ({\n        ...prevState,\n        [e.target.id]: boolean ?? e.target.value,\n      }))\n    }\n  }\n\n  if (loading) {\n    return <Spinner />\n  }\n\n  return (\n    <div className='profile'>\n      <header>\n        <p className='pageHeader'>Edit Listing</p>\n      </header>\n\n      <main>\n        <form onSubmit={onSubmit}>\n          <label className='formLabel'>Sell / Rent</label>\n          <div className='formButtons'>\n            <button\n              type='button'\n              className={type === 'sale' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='sale'\n              onClick={onMutate}\n            >\n              Sell\n            </button>\n            <button\n              type='button'\n              className={type === 'rent' ? 'formButtonActive' : 'formButton'}\n              id='type'\n              value='rent'\n              onClick={onMutate}\n            >\n              Rent\n            </button>\n          </div>\n\n          <label className='formLabel'>Name</label>\n          <input\n            className='formInputName'\n            type='text'\n            id='name'\n            value={name}\n            onChange={onMutate}\n            maxLength='32'\n            minLength='10'\n            required\n          />\n\n          <div className='formRooms flex'>\n            <div>\n              <label className='formLabel'>Bedrooms</label>\n              <input\n                className='formInputSmall'\n                type='number'\n                id='bedrooms'\n                value={bedrooms}\n                onChange={onMutate}\n                min='1'\n                max='50'\n                required\n              />\n            </div>\n            <div>\n              <label className='formLabel'>Bathrooms</label>\n              <input\n                className='formInputSmall'\n                type='number'\n                id='bathrooms'\n                value={bathrooms}\n                onChange={onMutate}\n                min='1'\n                max='50'\n                required\n              />\n            </div>\n          </div>\n\n          <label className='formLabel'>Parking spot</label>\n          <div className='formButtons'>\n            <button\n              className={parking ? 'formButtonActive' : 'formButton'}\n              type='button'\n              id='parking'\n              value={true}\n              onClick={onMutate}\n              min='1'\n              max='50'\n            >\n              Yes\n            </button>\n            <button\n              className={\n                !parking && parking !== null ? 'formButtonActive' : 'formButton'\n              }\n              type='button'\n              id='parking'\n              value={false}\n              onClick={onMutate}\n            >\n              No\n            </button>\n          </div>\n\n          <label className='formLabel'>Furnished</label>\n          <div className='formButtons'>\n            <button\n              className={furnished ? 'formButtonActive' : 'formButton'}\n              type='button'\n              id='furnished'\n              value={true}\n              onClick={onMutate}\n            >\n              Yes\n            </button>\n            <button\n              className={\n                !furnished && furnished !== null\n                  ? 'formButtonActive'\n                  : 'formButton'\n              }\n              type='button'\n              id='furnished'\n              value={false}\n              onClick={onMutate}\n            >\n              No\n            </button>\n          </div>\n\n          <label className='formLabel'>Address</label>\n          <textarea\n            className='formInputAddress'\n            type='text'\n            id='address'\n            value={address}\n            onChange={onMutate}\n            required\n          />\n\n          {!geolocationEnabled && (\n            <div className='formLatLng flex'>\n              <div>\n                <label className='formLabel'>Latitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='latitude'\n                  value={latitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n              <div>\n                <label className='formLabel'>Longitude</label>\n                <input\n                  className='formInputSmall'\n                  type='number'\n                  id='longitude'\n                  value={longitude}\n                  onChange={onMutate}\n                  required\n                />\n              </div>\n            </div>\n          )}\n\n          <label className='formLabel'>Offer</label>\n          <div className='formButtons'>\n            <button\n              className={offer ? 'formButtonActive' : 'formButton'}\n              type='button'\n              id='offer'\n              value={true}\n              onClick={onMutate}\n            >\n              Yes\n            </button>\n            <button\n              className={\n                !offer && offer !== null ? 'formButtonActive' : 'formButton'\n              }\n              type='button'\n              id='offer'\n              value={false}\n              onClick={onMutate}\n            >\n              No\n            </button>\n          </div>\n\n          <label className='formLabel'>Regular Price</label>\n          <div className='formPriceDiv'>\n            <input\n              className='formInputSmall'\n              type='number'\n              id='regularPrice'\n              value={regularPrice}\n              onChange={onMutate}\n              min='50'\n              max='750000000'\n              required\n            />\n            {type === 'rent' && <p className='formPriceText'>$ / Month</p>}\n          </div>\n\n          {offer && (\n            <>\n              <label className='formLabel'>Discounted Price</label>\n              <input\n                className='formInputSmall'\n                type='number'\n                id='discountedPrice'\n                value={discountedPrice}\n                onChange={onMutate}\n                min='50'\n                max='750000000'\n                required={offer}\n              />\n            </>\n          )}\n\n          <label className='formLabel'>Images</label>\n          <p className='imagesInfo'>\n            The first image will be the cover (max 6).\n          </p>\n          <input\n            className='formInputFile'\n            type='file'\n            id='images'\n            onChange={onMutate}\n            max='6'\n            accept='.jpg,.png,.jpeg'\n            multiple\n            required\n          />\n          <button type='submit' className='primaryButton createListingButton'>\n            Edit Listing\n          </button>\n        </form>\n      </main>\n    </div>\n  )\n}\n\nexport default EditListing\n\n"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AACnD,SAASC,OAAO,EAAEC,kBAAkB,QAAQ,eAAe;AAC3D,SACEC,UAAU,EACVC,GAAG,EACHC,oBAAoB,EACpBC,cAAc,QACT,kBAAkB;AACzB,SAASC,GAAG,EAAEC,SAAS,EAAEC,MAAM,EAAEC,eAAe,QAAQ,oBAAoB;AAC5E,SAASC,EAAE,QAAQ,oBAAoB;AACvC,SAASC,WAAW,EAAEC,SAAS,QAAQ,kBAAkB;AACzD,SAASC,KAAK,QAAQ,gBAAgB;AACtC,SAASC,EAAE,IAAIC,MAAM,QAAQ,MAAM;AACnC,OAAOC,OAAO,MAAM,uBAAuB;AAAA,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE3C,SAASC,WAAWA,CAAA,EAAG;EAAAC,EAAA;EACrB;EACA,MAAM,CAACC,kBAAkB,EAAEC,qBAAqB,CAAC,GAAG3B,QAAQ,CAAC,IAAI,CAAC;EAClE,MAAM,CAAC4B,OAAO,EAAEC,UAAU,CAAC,GAAG7B,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAAC8B,OAAO,EAAEC,UAAU,CAAC,GAAG/B,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACgC,QAAQ,EAAEC,WAAW,CAAC,GAAGjC,QAAQ,CAAC;IACvCkC,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,EAAE;IACRC,QAAQ,EAAE,CAAC;IACXC,SAAS,EAAE,CAAC;IACZC,OAAO,EAAE,KAAK;IACdC,SAAS,EAAE,KAAK;IAChBC,OAAO,EAAE,EAAE;IACXC,KAAK,EAAE,KAAK;IACZC,YAAY,EAAE,CAAC;IACfC,eAAe,EAAE,CAAC;IAClBC,MAAM,EAAE,CAAC,CAAC;IACVC,QAAQ,EAAE,CAAC;IACXC,SAAS,EAAE;EACb,CAAC,CAAC;EAEF,MAAM;IACJZ,IAAI;IACJC,IAAI;IACJC,QAAQ;IACRC,SAAS;IACTC,OAAO;IACPC,SAAS;IACTC,OAAO;IACPC,KAAK;IACLC,YAAY;IACZC,eAAe;IACfC,MAAM;IACNC,QAAQ;IACRC;EACF,CAAC,GAAGd,QAAQ;EAEZ,MAAMe,IAAI,GAAG5C,OAAO,CAAC,CAAC;EACtB,MAAM6C,QAAQ,GAAGlC,WAAW,CAAC,CAAC;EAC9B,MAAMmC,MAAM,GAAGlC,SAAS,CAAC,CAAC;EAC1B,MAAMmC,SAAS,GAAGhD,MAAM,CAAC,IAAI,CAAC;;EAE9B;EACAD,SAAS,CAAC,MAAM;IACd,IAAI6B,OAAO,IAAIA,OAAO,CAACqB,OAAO,KAAKJ,IAAI,CAACK,WAAW,CAACC,GAAG,EAAE;MACvDrC,KAAK,CAACsC,KAAK,CAAC,+BAA+B,CAAC;MAC5CN,QAAQ,CAAC,GAAG,CAAC;IACf;EACF,CAAC,CAAC;;EAEF;EACA/C,SAAS,CAAC,MAAM;IACd4B,UAAU,CAAC,IAAI,CAAC;IAChB,MAAM0B,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,MAAMC,MAAM,GAAG/C,GAAG,CAACI,EAAE,EAAE,UAAU,EAAEoC,MAAM,CAACQ,SAAS,CAAC;MACpD,MAAMC,OAAO,GAAG,MAAM/C,MAAM,CAAC6C,MAAM,CAAC;MACpC,IAAIE,OAAO,CAACC,MAAM,CAAC,CAAC,EAAE;QACpB5B,UAAU,CAAC2B,OAAO,CAACE,IAAI,CAAC,CAAC,CAAC;QAC1B3B,WAAW,CAAC;UAAE,GAAGyB,OAAO,CAACE,IAAI,CAAC,CAAC;UAAEpB,OAAO,EAAEkB,OAAO,CAACE,IAAI,CAAC,CAAC,CAACC;QAAS,CAAC,CAAC;QACpEhC,UAAU,CAAC,KAAK,CAAC;MACnB,CAAC,MAAM;QACLmB,QAAQ,CAAC,GAAG,CAAC;QACbhC,KAAK,CAACsC,KAAK,CAAC,wBAAwB,CAAC;MACvC;IACF,CAAC;IAEDC,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,CAACN,MAAM,CAACQ,SAAS,EAAET,QAAQ,CAAC,CAAC;;EAEhC;EACA/C,SAAS,CAAC,MAAM;IACd,IAAIiD,SAAS,EAAE;MACb9C,kBAAkB,CAAC2C,IAAI,EAAGe,IAAI,IAAK;QACjC,IAAIA,IAAI,EAAE;UACR7B,WAAW,CAAC;YAAE,GAAGD,QAAQ;YAAEmB,OAAO,EAAEW,IAAI,CAACT;UAAI,CAAC,CAAC;QACjD,CAAC,MAAM;UACLL,QAAQ,CAAC,UAAU,CAAC;QACtB;MACF,CAAC,CAAC;IACJ;IAEA,OAAO,MAAM;MACXE,SAAS,CAACa,OAAO,GAAG,KAAK;IAC3B,CAAC;IACD;EACF,CAAC,EAAE,CAACb,SAAS,CAAC,CAAC;EAEf,MAAMc,QAAQ,GAAG,MAAOC,CAAC,IAAK;IAC5BA,CAAC,CAACC,cAAc,CAAC,CAAC;IAElBrC,UAAU,CAAC,IAAI,CAAC;IAEhB,IAAIc,eAAe,IAAID,YAAY,EAAE;MACnCb,UAAU,CAAC,KAAK,CAAC;MACjBb,KAAK,CAACsC,KAAK,CAAC,sDAAsD,CAAC;MACnE;IACF;IAEA,IAAIV,MAAM,CAACuB,MAAM,GAAG,CAAC,EAAE;MACrBtC,UAAU,CAAC,KAAK,CAAC;MACjBb,KAAK,CAACsC,KAAK,CAAC,cAAc,CAAC;MAC3B;IACF;IAEA,IAAIc,WAAW,GAAG,CAAC,CAAC;IACpB,IAAIP,QAAQ;IAEZ,IAAInC,kBAAkB,EAAE;MAAA,IAAA2C,qBAAA,EAAAC,cAAA,EAAAC,sBAAA,EAAAC,eAAA,EAAAC,eAAA;MACtB,MAAMC,QAAQ,GAAG,MAAMC,KAAK,8DAAAC,MAAA,CACmCpC,OAAO,WAAAoC,MAAA,CAAQC,OAAO,CAACC,GAAG,CAACC,yBAAyB,CACnH,CAAC;MAED,MAAMnB,IAAI,GAAG,MAAMc,QAAQ,CAACM,IAAI,CAAC,CAAC;MAElCZ,WAAW,CAACa,GAAG,IAAAZ,qBAAA,IAAAC,cAAA,GAAGV,IAAI,CAACsB,OAAO,CAAC,CAAC,CAAC,cAAAZ,cAAA,uBAAfA,cAAA,CAAiBa,QAAQ,CAACtB,QAAQ,CAACoB,GAAG,cAAAZ,qBAAA,cAAAA,qBAAA,GAAI,CAAC;MAC7DD,WAAW,CAACgB,GAAG,IAAAb,sBAAA,IAAAC,eAAA,GAAGZ,IAAI,CAACsB,OAAO,CAAC,CAAC,CAAC,cAAAV,eAAA,uBAAfA,eAAA,CAAiBW,QAAQ,CAACtB,QAAQ,CAACuB,GAAG,cAAAb,sBAAA,cAAAA,sBAAA,GAAI,CAAC;MAE7DV,QAAQ,GACND,IAAI,CAACyB,MAAM,KAAK,cAAc,GAC1BC,SAAS,IAAAb,eAAA,GACTb,IAAI,CAACsB,OAAO,CAAC,CAAC,CAAC,cAAAT,eAAA,uBAAfA,eAAA,CAAiBc,iBAAiB;MAExC,IAAI1B,QAAQ,KAAKyB,SAAS,IAAIzB,QAAQ,CAAC2B,QAAQ,CAAC,WAAW,CAAC,EAAE;QAC5D3D,UAAU,CAAC,KAAK,CAAC;QACjBb,KAAK,CAACsC,KAAK,CAAC,gCAAgC,CAAC;QAC7C;MACF;IACF,CAAC,MAAM;MACLc,WAAW,CAACa,GAAG,GAAGpC,QAAQ;MAC1BuB,WAAW,CAACgB,GAAG,GAAGtC,SAAS;IAC7B;;IAEA;IACA,MAAM2C,UAAU,GAAG,MAAOC,KAAK,IAAK;MAClC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtC,MAAMC,OAAO,GAAGzF,UAAU,CAAC,CAAC;QAC5B,MAAM0F,QAAQ,MAAAnB,MAAA,CAAM7B,IAAI,CAACK,WAAW,CAACC,GAAG,OAAAuB,MAAA,CAAIc,KAAK,CAACvD,IAAI,OAAAyC,MAAA,CAAI1D,MAAM,CAAC,CAAC,CAAE;QAEpE,MAAM8E,UAAU,GAAG1F,GAAG,CAACwF,OAAO,EAAE,SAAS,GAAGC,QAAQ,CAAC;QAErD,MAAME,UAAU,GAAG1F,oBAAoB,CAACyF,UAAU,EAAEN,KAAK,CAAC;QAE1DO,UAAU,CAACC,EAAE,CACX,eAAe,EACdC,QAAQ,IAAK;UACZ,MAAMC,QAAQ,GACXD,QAAQ,CAACE,gBAAgB,GAAGF,QAAQ,CAACG,UAAU,GAAI,GAAG;UACzDC,OAAO,CAACC,GAAG,CAAC,YAAY,GAAGJ,QAAQ,GAAG,QAAQ,CAAC;UAC/C,QAAQD,QAAQ,CAACM,KAAK;YACpB,KAAK,QAAQ;cACXF,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;cAC/B;YACF,KAAK,SAAS;cACZD,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;cAChC;YACF;cACE;UACJ;QACF,CAAC,EACAlD,KAAK,IAAK;UACTuC,MAAM,CAACvC,KAAK,CAAC;QACf,CAAC,EACD,MAAM;UACJ;UACA;UACA9C,cAAc,CAACyF,UAAU,CAACE,QAAQ,CAAC7F,GAAG,CAAC,CAACoG,IAAI,CAAEC,WAAW,IAAK;YAC5Df,OAAO,CAACe,WAAW,CAAC;UACtB,CAAC,CAAC;QACJ,CACF,CAAC;MACH,CAAC,CAAC;IACJ,CAAC;IAED,MAAMC,OAAO,GAAG,MAAMjB,OAAO,CAACkB,GAAG,CAC/B,CAAC,GAAGjE,MAAM,CAAC,CAACkE,GAAG,CAAEpB,KAAK,IAAKD,UAAU,CAACC,KAAK,CAAC,CAC9C,CAAC,CAACqB,KAAK,CAAC,MAAM;MACZlF,UAAU,CAAC,KAAK,CAAC;MACjBb,KAAK,CAACsC,KAAK,CAAC,qBAAqB,CAAC;MAClC;IACF,CAAC,CAAC;IAEF,MAAM0D,YAAY,GAAG;MACnB,GAAGhF,QAAQ;MACX4E,OAAO;MACPxC,WAAW;MACX6C,SAAS,EAAErG,eAAe,CAAC;IAC7B,CAAC;IAEDoG,YAAY,CAACnD,QAAQ,GAAGrB,OAAO;IAC/B,OAAOwE,YAAY,CAACpE,MAAM;IAC1B,OAAOoE,YAAY,CAACxE,OAAO;IAC3B,CAACwE,YAAY,CAACvE,KAAK,IAAI,OAAOuE,YAAY,CAACrE,eAAe;;IAE1D;IACA,MAAMa,MAAM,GAAG/C,GAAG,CAACI,EAAE,EAAE,UAAU,EAAEoC,MAAM,CAACQ,SAAS,CAAC;IACpD,MAAM/C,SAAS,CAAC8C,MAAM,EAAEwD,YAAY,CAAC;IACrCnF,UAAU,CAAC,KAAK,CAAC;IACjBb,KAAK,CAACkG,OAAO,CAAC,eAAe,CAAC;IAC9BlE,QAAQ,cAAA4B,MAAA,CAAcoC,YAAY,CAAC9E,IAAI,OAAA0C,MAAA,CAAIpB,MAAM,CAAC2D,EAAE,CAAE,CAAC;EACzD,CAAC;EAED,MAAMC,QAAQ,GAAInD,CAAC,IAAK;IACtB,IAAIoD,OAAO,GAAG,IAAI;IAElB,IAAIpD,CAAC,CAACqD,MAAM,CAACC,KAAK,KAAK,MAAM,EAAE;MAC7BF,OAAO,GAAG,IAAI;IAChB;IACA,IAAIpD,CAAC,CAACqD,MAAM,CAACC,KAAK,KAAK,OAAO,EAAE;MAC9BF,OAAO,GAAG,KAAK;IACjB;;IAEA;IACA,IAAIpD,CAAC,CAACqD,MAAM,CAACE,KAAK,EAAE;MAClBvF,WAAW,CAAEwF,SAAS,KAAM;QAC1B,GAAGA,SAAS;QACZ7E,MAAM,EAAEqB,CAAC,CAACqD,MAAM,CAACE;MACnB,CAAC,CAAC,CAAC;IACL;;IAEA;IACA,IAAI,CAACvD,CAAC,CAACqD,MAAM,CAACE,KAAK,EAAE;MACnBvF,WAAW,CAAEwF,SAAS;QAAA,IAAAC,QAAA;QAAA,OAAM;UAC1B,GAAGD,SAAS;UACZ,CAACxD,CAAC,CAACqD,MAAM,CAACH,EAAE,IAAAO,QAAA,GAAGL,OAAO,cAAAK,QAAA,cAAAA,QAAA,GAAIzD,CAAC,CAACqD,MAAM,CAACC;QACrC,CAAC;MAAA,CAAC,CAAC;IACL;EACF,CAAC;EAED,IAAI3F,OAAO,EAAE;IACX,oBAAOP,OAAA,CAACF,OAAO;MAAA4E,QAAA,EAAA4B,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACpB;EAEA,oBACExG,OAAA;IAAKyG,SAAS,EAAC,SAAS;IAAAC,QAAA,gBACtB1G,OAAA;MAAA0G,QAAA,eACE1G,OAAA;QAAGyG,SAAS,EAAC,YAAY;QAAAC,QAAA,EAAC;MAAY;QAAAhC,QAAA,EAAA4B,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG;IAAC;MAAA9B,QAAA,EAAA4B,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpC,CAAC,eAETxG,OAAA;MAAA0G,QAAA,eACE1G,OAAA;QAAM2C,QAAQ,EAAEA,QAAS;QAAA+D,QAAA,gBACvB1G,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAW;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAChDxG,OAAA;UAAKyG,SAAS,EAAC,aAAa;UAAAC,QAAA,gBAC1B1G,OAAA;YACEa,IAAI,EAAC,QAAQ;YACb4F,SAAS,EAAE5F,IAAI,KAAK,MAAM,GAAG,kBAAkB,GAAG,YAAa;YAC/DiF,EAAE,EAAC,MAAM;YACTI,KAAK,EAAC,MAAM;YACZS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACTxG,OAAA;YACEa,IAAI,EAAC,QAAQ;YACb4F,SAAS,EAAE5F,IAAI,KAAK,MAAM,GAAG,kBAAkB,GAAG,YAAa;YAC/DiF,EAAE,EAAC,MAAM;YACTI,KAAK,EAAC,MAAM;YACZS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAENxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAI;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACzCxG,OAAA;UACEyG,SAAS,EAAC,eAAe;UACzB5F,IAAI,EAAC,MAAM;UACXiF,EAAE,EAAC,MAAM;UACTI,KAAK,EAAEpF,IAAK;UACZ8F,QAAQ,EAAEb,QAAS;UACnBc,SAAS,EAAC,IAAI;UACdC,SAAS,EAAC,IAAI;UACdC,QAAQ;QAAA;UAAArC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACT,CAAC,eAEFxG,OAAA;UAAKyG,SAAS,EAAC,gBAAgB;UAAAC,QAAA,gBAC7B1G,OAAA;YAAA0G,QAAA,gBACE1G,OAAA;cAAOyG,SAAS,EAAC,WAAW;cAAAC,QAAA,EAAC;YAAQ;cAAAhC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC7CxG,OAAA;cACEyG,SAAS,EAAC,gBAAgB;cAC1B5F,IAAI,EAAC,QAAQ;cACbiF,EAAE,EAAC,UAAU;cACbI,KAAK,EAAEnF,QAAS;cAChB6F,QAAQ,EAAEb,QAAS;cACnBiB,GAAG,EAAC,GAAG;cACPC,GAAG,EAAC,IAAI;cACRF,QAAQ;YAAA;cAAArC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACT,CAAC;UAAA;YAAA9B,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,eACNxG,OAAA;YAAA0G,QAAA,gBACE1G,OAAA;cAAOyG,SAAS,EAAC,WAAW;cAAAC,QAAA,EAAC;YAAS;cAAAhC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC9CxG,OAAA;cACEyG,SAAS,EAAC,gBAAgB;cAC1B5F,IAAI,EAAC,QAAQ;cACbiF,EAAE,EAAC,WAAW;cACdI,KAAK,EAAElF,SAAU;cACjB4F,QAAQ,EAAEb,QAAS;cACnBiB,GAAG,EAAC,GAAG;cACPC,GAAG,EAAC,IAAI;cACRF,QAAQ;YAAA;cAAArC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACT,CAAC;UAAA;YAAA9B,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAENxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAY;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACjDxG,OAAA;UAAKyG,SAAS,EAAC,aAAa;UAAAC,QAAA,gBAC1B1G,OAAA;YACEyG,SAAS,EAAExF,OAAO,GAAG,kBAAkB,GAAG,YAAa;YACvDJ,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,SAAS;YACZI,KAAK,EAAE,IAAK;YACZS,OAAO,EAAEZ,QAAS;YAClBiB,GAAG,EAAC,GAAG;YACPC,GAAG,EAAC,IAAI;YAAAP,QAAA,EACT;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACTxG,OAAA;YACEyG,SAAS,EACP,CAACxF,OAAO,IAAIA,OAAO,KAAK,IAAI,GAAG,kBAAkB,GAAG,YACrD;YACDJ,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,SAAS;YACZI,KAAK,EAAE,KAAM;YACbS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAENxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAS;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC9CxG,OAAA;UAAKyG,SAAS,EAAC,aAAa;UAAAC,QAAA,gBAC1B1G,OAAA;YACEyG,SAAS,EAAEvF,SAAS,GAAG,kBAAkB,GAAG,YAAa;YACzDL,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,WAAW;YACdI,KAAK,EAAE,IAAK;YACZS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACTxG,OAAA;YACEyG,SAAS,EACP,CAACvF,SAAS,IAAIA,SAAS,KAAK,IAAI,GAC5B,kBAAkB,GAClB,YACL;YACDL,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,WAAW;YACdI,KAAK,EAAE,KAAM;YACbS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAENxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAO;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC5CxG,OAAA;UACEyG,SAAS,EAAC,kBAAkB;UAC5B5F,IAAI,EAAC,MAAM;UACXiF,EAAE,EAAC,SAAS;UACZI,KAAK,EAAE/E,OAAQ;UACfyF,QAAQ,EAAEb,QAAS;UACnBgB,QAAQ;QAAA;UAAArC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACT,CAAC,EAED,CAACnG,kBAAkB,iBAClBL,OAAA;UAAKyG,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBAC9B1G,OAAA;YAAA0G,QAAA,gBACE1G,OAAA;cAAOyG,SAAS,EAAC,WAAW;cAAAC,QAAA,EAAC;YAAQ;cAAAhC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC7CxG,OAAA;cACEyG,SAAS,EAAC,gBAAgB;cAC1B5F,IAAI,EAAC,QAAQ;cACbiF,EAAE,EAAC,UAAU;cACbI,KAAK,EAAE1E,QAAS;cAChBoF,QAAQ,EAAEb,QAAS;cACnBgB,QAAQ;YAAA;cAAArC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACT,CAAC;UAAA;YAAA9B,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,eACNxG,OAAA;YAAA0G,QAAA,gBACE1G,OAAA;cAAOyG,SAAS,EAAC,WAAW;cAAAC,QAAA,EAAC;YAAS;cAAAhC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC9CxG,OAAA;cACEyG,SAAS,EAAC,gBAAgB;cAC1B5F,IAAI,EAAC,QAAQ;cACbiF,EAAE,EAAC,WAAW;cACdI,KAAK,EAAEzE,SAAU;cACjBmF,QAAQ,EAAEb,QAAS;cACnBgB,QAAQ;YAAA;cAAArC,QAAA,EAAA4B,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACT,CAAC;UAAA;YAAA9B,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CACN,eAEDxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAK;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC1CxG,OAAA;UAAKyG,SAAS,EAAC,aAAa;UAAAC,QAAA,gBAC1B1G,OAAA;YACEyG,SAAS,EAAErF,KAAK,GAAG,kBAAkB,GAAG,YAAa;YACrDP,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,OAAO;YACVI,KAAK,EAAE,IAAK;YACZS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACTxG,OAAA;YACEyG,SAAS,EACP,CAACrF,KAAK,IAAIA,KAAK,KAAK,IAAI,GAAG,kBAAkB,GAAG,YACjD;YACDP,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,OAAO;YACVI,KAAK,EAAE,KAAM;YACbS,OAAO,EAAEZ,QAAS;YAAAW,QAAA,EACnB;UAED;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAENxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAa;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAClDxG,OAAA;UAAKyG,SAAS,EAAC,cAAc;UAAAC,QAAA,gBAC3B1G,OAAA;YACEyG,SAAS,EAAC,gBAAgB;YAC1B5F,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,cAAc;YACjBI,KAAK,EAAE7E,YAAa;YACpBuF,QAAQ,EAAEb,QAAS;YACnBiB,GAAG,EAAC,IAAI;YACRC,GAAG,EAAC,WAAW;YACfF,QAAQ;UAAA;YAAArC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACT,CAAC,EACD3F,IAAI,KAAK,MAAM,iBAAIb,OAAA;YAAGyG,SAAS,EAAC,eAAe;YAAAC,QAAA,EAAC;UAAS;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC;QAAA;UAAA9B,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC3D,CAAC,EAELpF,KAAK,iBACJpB,OAAA,CAAAE,SAAA;UAAAwG,QAAA,gBACE1G,OAAA;YAAOyG,SAAS,EAAC,WAAW;YAAAC,QAAA,EAAC;UAAgB;YAAAhC,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO,CAAC,eACrDxG,OAAA;YACEyG,SAAS,EAAC,gBAAgB;YAC1B5F,IAAI,EAAC,QAAQ;YACbiF,EAAE,EAAC,iBAAiB;YACpBI,KAAK,EAAE5E,eAAgB;YACvBsF,QAAQ,EAAEb,QAAS;YACnBiB,GAAG,EAAC,IAAI;YACRC,GAAG,EAAC,WAAW;YACfF,QAAQ,EAAE3F;UAAM;YAAAsD,QAAA,EAAA4B,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACjB,CAAC;QAAA,eACF,CACH,eAEDxG,OAAA;UAAOyG,SAAS,EAAC,WAAW;UAAAC,QAAA,EAAC;QAAM;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eAC3CxG,OAAA;UAAGyG,SAAS,EAAC,YAAY;UAAAC,QAAA,EAAC;QAE1B;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,eACJxG,OAAA;UACEyG,SAAS,EAAC,eAAe;UACzB5F,IAAI,EAAC,MAAM;UACXiF,EAAE,EAAC,QAAQ;UACXc,QAAQ,EAAEb,QAAS;UACnBkB,GAAG,EAAC,GAAG;UACPC,MAAM,EAAC,iBAAiB;UACxBC,QAAQ;UACRJ,QAAQ;QAAA;UAAArC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACT,CAAC,eACFxG,OAAA;UAAQa,IAAI,EAAC,QAAQ;UAAC4F,SAAS,EAAC,mCAAmC;UAAAC,QAAA,EAAC;QAEpE;UAAAhC,QAAA,EAAA4B,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAA9B,QAAA,EAAA4B,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL;IAAC;MAAA9B,QAAA,EAAA4B,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC;EAAA;IAAA9B,QAAA,EAAA4B,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACJ,CAAC;AAEV;AAACpG,EAAA,CApdQD,WAAW;EAAA,QAsCDV,WAAW,EACbC,SAAS;AAAA;AAAA0H,EAAA,GAvCjBjH,WAAW;AAsdpB,eAAeA,WAAW;AAAA,IAAAiH,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module"}